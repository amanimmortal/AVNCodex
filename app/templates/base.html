<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AVN Codex{% endblock %}</title>

    {# Bootstrap Icons #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>

<body>
    {# Top Navigation #}
    <div class="top-bar">
        <div class="brand">
            <a href="{{ url_for('index') }}" style="color: white; text-decoration: none;">AVN Codex</a>
        </div>
        <div class="top-bar-nav">
            <a href="{{ url_for('index') }}">My Games</a>
            <a href="{{ url_for('search') }}">Add Game</a>
        </div>
        <div class="user-actions">
            {% if g.user %}
            <span class="me-2 text-white" style="font-size: 0.9rem;">{{ g.user.username }}</span>
            <a href="{{ url_for('settings') }}" class="btn btn-sm btn-secondary">Settings</a>
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-primary"
                style="border-color: white; color: white;">Logout</a>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-sm btn-primary">Login</a>
            <a href="{{ url_for('register') }}" class="btn btn-sm btn-secondary">Register</a>
            {% endif %}
        </div>
    </div>

    {# Toast Container #}
    <div id="toast-container" class="temp-notification-container"></div>

    {# Main Layout #}
    <div class="container container-fluid ">
        <div class="main-content">
            {% block main_content %}
            {# Content from child templates will go here #}
            {% endblock %}
        </div>

        {# We might want to remove this sidebar if we move to a cleaner layout,
        but for now keeping it as requested to not touch app logic too much.
        However, standard layout in style.css doesn't use sidebar class much.
        Let's see if we can just hide it if empty or keep it as legacy.
        The new edit_game uses its own grid.
        Index uses sidebar. #}

        {#
        <aside class="sidebar">
            {% block sidebar %}
            ...
            {% endblock %}
        </aside>
        #}
    </div>

    {# Global Scripts #}
    <script>
        // Toast Notification System
        function showToast(message, category = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `custom-toast ${category}`;

            let icon = 'bi-info-circle';
            if (category === 'success') icon = 'bi-check-circle';
            if (category === 'error') icon = 'bi-exclamation-circle';
            if (category === 'warning') icon = 'bi-exclamation-triangle';

            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="bi ${icon}" style="font-size: 1.2rem;"></i>
                    <span>${message}</span>
                </div>
                <button onclick="this.parentElement.remove()" style="background:none; border:none; color:white; cursor:pointer;">
                    <i class="bi bi-x-lg"></i>
                </button>
            `;

            container.appendChild(toast);

            // Auto dismiss
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Initialize Flash Messages from Server
        document.addEventListener('DOMContentLoaded', () => {
            const messages = {{ get_flashed_messages(with_categories = true) | tojson | safe
        }};
        if (messages) {
            messages.forEach(([category, message]) => {
                showToast(message, category);
            });
        }
        });
    </script>

    {% block page_scripts %}{% endblock %}
    {% block scripts %}{% endblock %}
</body>

</html>